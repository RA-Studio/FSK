<template>
<div class="content">
        <step-block></step-block>
        <div class="info">
          <div class="container">
            <h2 class="h1 title"> Тождественность согласия супруга(и) / свид-ва о браке / брачного договора</h2>
            <div class="info-greytext">
              <svg width="50" height="50" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M40.2344 13.2812C40.2344 13.8203 40.6719 14.2578 41.2109 14.2578C41.75 14.2578 42.1875 13.8203 42.1875 13.2812C42.1875 12.7422 41.75 12.3047 41.2109 12.3047C40.6719 12.3047 40.2344 12.7422 40.2344 13.2812Z" fill="#D7D7D7"/>
<path d="M44.1416 24.9989C44.1416 26.2498 44.0161 27.4983 43.7689 28.7099C43.661 29.2382 44.002 29.754 44.5303 29.8619C44.5963 29.8756 44.662 29.8821 44.7268 29.8821C45.1811 29.8821 45.5882 29.5628 45.6828 29.1005C45.9563 27.7604 46.0948 26.3806 46.0948 24.9989C46.0948 21.9239 45.4279 18.9649 44.1123 16.2038C43.8803 15.717 43.2978 15.5103 42.8107 15.7422C42.3235 15.9741 42.1172 16.557 42.3491 17.0442C43.5385 19.5405 44.1416 22.2169 44.1416 24.9989Z" fill="#D7D7D7"/>
<path d="M29.8828 33.7891H28.9062V21.0938C28.9062 20.5544 28.4691 20.1172 27.9297 20.1172H20.1172C19.5778 20.1172 19.1406 20.5544 19.1406 21.0938V25C19.1406 25.5394 19.5778 25.9766 20.1172 25.9766H21.0938V33.7891H20.1172C19.5778 33.7891 19.1406 34.2262 19.1406 34.7656V38.6719C19.1406 39.2113 19.5778 39.6484 20.1172 39.6484H29.8828C30.4222 39.6484 30.8594 39.2113 30.8594 38.6719V34.7656C30.8594 34.2262 30.4222 33.7891 29.8828 33.7891ZM28.9062 37.6953H21.0938V35.7422H22.0703C22.6097 35.7422 23.0469 35.305 23.0469 34.7656V25C23.0469 24.4606 22.6097 24.0234 22.0703 24.0234H21.0938V22.0703H26.9531V34.7656C26.9531 35.305 27.3907 35.7422 27.9297 35.7422H28.9062V37.6953Z" fill="#D7D7D7"/>
<path d="M25 18.1641C27.1538 18.1641 28.9062 16.4116 28.9062 14.2578C28.9062 12.104 27.1538 10.3516 25 10.3516C22.8462 10.3516 21.0938 12.104 21.0938 14.2578C21.0938 16.4116 22.8462 18.1641 25 18.1641ZM25 12.3047C26.0769 12.3047 26.9531 13.1809 26.9531 14.2578C26.9531 15.3347 26.0769 16.2109 25 16.2109C23.9231 16.2109 23.0469 15.3347 23.0469 14.2578C23.0469 13.1809 23.9231 12.3047 25 12.3047Z" fill="#D7D7D7"/>
<path d="M25 0C11.5258 0 4.25859e-05 11.504 4.25859e-05 25C4.25859e-05 29.6101 1.32107 34.5127 3.54847 38.221L0.0500151 48.7148C-0.0667146 49.0654 0.0244566 49.4526 0.286145 49.7139C0.548978 49.9767 0.936551 50.0664 1.2856 49.9496L11.7794 46.4516C15.4873 48.6794 20.39 50 25 50C38.4777 50 50 38.4945 50 25C50 11.5223 38.4949 0 25 0V0ZM25 48.0469C20.5777 48.0469 15.8772 46.7419 12.426 44.556C12.1815 44.4012 11.8767 44.3604 11.5944 44.4546L2.52079 47.4792L5.54547 38.4056C5.63855 38.1271 5.60116 37.822 5.444 37.574C3.25818 34.1232 1.95317 29.4224 1.95317 25C1.95317 12.5072 12.5073 1.95312 25 1.95312C37.4928 1.95312 48.0469 12.5072 48.0469 25C48.0469 37.4928 37.4928 48.0469 25 48.0469Z" fill="#D7D7D7"/>
</svg>Процедура тождества (удостоверения) электронного и бумажного документов означает подтверждение тождественности содержания изготовленного нотариусом электронного документа содержанию документа, представленного нотариусу на бумажном носителе.
            </div>
            <div class="info-withside">
              <div class="info-withside-content">
                <div class="info-load-row">Так как ранее вы указали, что состоите в законном браке, то вам нужно посетить любого сертифицированного нотариуса с вашим супругом(ой) для получения тождественности. Если у вас нет возможности посетить нотариуса самостоятельно, мы обеспечим выезд нотариуса - это потребуется согласовать с менеджером по тел. (812) 703-55-55.</div>
                <div class="info-load-row">При посещении нотариуса вам понадобятся следующие документы:</br>- паспорта обоих супругов</br>- свидетельство о браке / брачный договор / согласие супруга(и)</div>
                <div class="info-load-row">Получив от нотариуса специальные файлы - тождественность и удостоверяющую электронную подпись, загрузите их в соответствующие поля на этой странице.</br>Обратите внимание, что данные файлы загружаются в специальном формате с расширением pdf.sig. Нотариусы в курсе и передадут их вам в необходимом виде.  </div>
                <div class="info-load-row">После загрузки нажмите на кнопку “Завершить сбор документов”. Весь пакет документов отправится на проверку нашему специалисту. Проверка занимает некоторое время, мы известим о результате по смс. </div>
              </div>
              <div class="info-withside-side">
                  <slot v-for="(user, userKey) in users">
                      <components :is="`default-file`" :input="input" :inputKey="`${inputKey}${userKey}`" :key="`${inputKey}${userKey}`" v-for="(input, inputKey) in user.files" :multiple="true" :typeRecommendedOut="input.typeRecommended ? input.typeRecommended : []"></components>
                  </slot>
              </div>
            </div>
            <div class="info-contract__btn-wrap">
              <a class="info-contract__btn btn-new btn--bg" href="#" @click="sendFile()">Завершить сбор документов</a>
            </div>
          </div>
        </div>
      </div>
</template>
<script>
    import Vue from 'vue';
    import DefaultFile from './../../../../defaultFile.vue';
    import axios from 'axios';
    import qs from 'qs';

    import StepBlock from './../Step.vue'

    export default {
        data () {
            return {
                users: {},
            }
        },
        created() {
            let usersIdentification = Object.keys(this.$store.getters.userInfo);
            let keyUser = usersIdentification[0];
            this.fileUserAdd(keyUser, this.$store.getters.userInfo[keyUser].data);
        },
        updated() {},
        components: {
            DefaultFile,
            StepBlock,
        },
        computed: {},
        methods: {
            fileUserAdd(iterator, info = {}) {
                this.$set(this.users, iterator, {
                    files: {
                        scanIdentity: { type: 'file', lable: `Скан тождественности`, class: '', files: {} },
                        electronicSignature: { type: 'file', lable: `Электронная подпись`, class: '', files: {}, typeRecommended: ['application/sig'] }
                    },
                });
            },
            collectBlockFile() {
                let formDataFile = new FormData();
                for(let userID in this.users) {
                    for(let fieldKey in this.users[userID].files) {
                        let file = this.users[userID].files[fieldKey].files;
                        for(let i in file) {
                            if (Object.keys(file).length > 0) formDataFile.append(`files[${userID}][${fieldKey}][${i}]`, file[i]);
                        }
                    }
                }
                return formDataFile;
            },
            checkFile() {
                let error = false;
                for(let userID in this.users) {
                    for(let fieldKey in this.users[userID].files) {
                        let file = this.users[userID].files[fieldKey].files;
                        if (Object.keys(file).length === 0) error = true;
                    }
                }
                return error;
            },
            sendFile() {
                if(this.checkFile()) {
                    this.$store.dispatch('addGlobalMessege', {  type: 'error', message: 'Для отправки нужно загрузить все файлы' });
                    return false;
                }
                this.$store.commit('setLoader', { status: true });
                let status = this.$store.getters.orderStatus + 1;
                let form = this.collectBlockFile();
                form.append('dir', 'order');
                form.append('saveInOrder', 'Y');
                form.append(`reserve`, this.$store.getters.reserve);
                form.append(`status`, status);
                axios.post('/ajax/?act=Order.SaveFileOrder', form, { headers: { 'Content-Type': 'multipart/form-data' } }).then(response => {
                    this.$store.commit('setLoader', { status: false });
                    if(response.data.isSuccess) {
                        this.$store.dispatch('addGlobalMessege', {  type: 'ok', message: 'Ваши файлы успешно отправлены' });
                    } else {
                        this.$store.dispatch('addGlobalMessege', { type: 'error', message: response.data.message });
                    }
                }).catch(error => this.$store.commit('setLoader', { status: false }));
            },
        },
    };
</script>
